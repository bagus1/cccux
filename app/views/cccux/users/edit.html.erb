<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
  <h1>Edit User: <%= @user.email %></h1>
  <div>
    <%= link_to "View User", cccux.user_path(@user), 
        style: "background-color: #17a2b8; color: white; padding: 0.5rem 1rem; text-decoration: none; border-radius: 4px; margin-right: 0.5rem;" %>
    <%= link_to "Back to Users", cccux.users_path, 
        style: "background-color: #6c757d; color: white; padding: 0.5rem 1rem; text-decoration: none; border-radius: 4px;" %>
  </div>
</div>

<%= form_with model: [@user], url: cccux.user_path(@user), method: :patch, local: true, 
    style: "background-color: white; border: 1px solid #dee2e6; border-radius: 8px; padding: 2rem;" do |form| %>
  
  <% if @user.errors.any? %>
    <div style="background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; border-radius: 4px; padding: 1rem; margin-bottom: 2rem;">
      <h4 style="margin-top: 0;">Please fix the following errors:</h4>
      <ul style="margin-bottom: 0;">
        <% @user.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
    <!-- User Information -->
    <div>
      <h3 style="margin-top: 0; color: #495057; border-bottom: 2px solid #e9ecef; padding-bottom: 0.5rem;">User Information</h3>
      
      <div style="margin-bottom: 1.5rem;">
        <%= form.label :email, style: "display: block; margin-bottom: 0.5rem; font-weight: bold; color: #495057;" %>
        <%= form.email_field :email, 
            style: "width: 100%; padding: 0.75rem; border: 1px solid #ced4da; border-radius: 4px; font-size: 1rem;" %>
        <small style="color: #6c757d;">This will be used for login</small>
      </div>

      <div style="margin-bottom: 1.5rem;">
        <%= form.label :first_name, style: "display: block; margin-bottom: 0.5rem; font-weight: bold; color: #495057;" %>
        <%= form.text_field :first_name, 
            style: "width: 100%; padding: 0.75rem; border: 1px solid #ced4da; border-radius: 4px; font-size: 1rem;" %>
      </div>

      <div style="margin-bottom: 1.5rem;">
        <%= form.label :last_name, style: "display: block; margin-bottom: 0.5rem; font-weight: bold; color: #495057;" %>
        <%= form.text_field :last_name, 
            style: "width: 100%; padding: 0.75rem; border: 1px solid #ced4da; border-radius: 4px; font-size: 1rem;" %>
      </div>

      <div style="margin-bottom: 1.5rem;">
        <%= form.label :notes, style: "display: block; margin-bottom: 0.5rem; font-weight: bold; color: #495057;" %>
        <%= form.text_area :notes, rows: 3,
            style: "width: 100%; padding: 0.75rem; border: 1px solid #ced4da; border-radius: 4px; font-size: 1rem; resize: vertical;" %>
        <small style="color: #6c757d;">Optional notes about this user</small>
      </div>

      <div style="margin-bottom: 1.5rem;">
        <label style="display: flex; align-items: center; cursor: pointer;">
          <%= form.check_box :active, 
              style: "margin-right: 0.5rem;" %>
          <span style="font-weight: bold; color: #495057;">Active User</span>
        </label>
        <small style="color: #6c757d; margin-left: 1.5rem;">Inactive users cannot log in</small>
      </div>

      <div style="background-color: #f8f9fa; padding: 1rem; border-radius: 4px;">
        <strong style="color: #495057;">Account Created:</strong>
        <div style="margin-top: 0.5rem; color: #6c757d;">
          <%= @user.created_at.strftime('%B %d, %Y at %I:%M %p') %>
        </div>
      </div>
    </div>

    <!-- Role Assignment -->
    <div>
      <h3 style="margin-top: 0; color: #495057; border-bottom: 2px solid #e9ecef; padding-bottom: 0.5rem;">Role Assignment</h3>
      
      <% if @available_roles.any? || @user.roles.any? %>
        <div style="margin-bottom: 1rem;">
          <p style="color: #6c757d; margin-bottom: 1rem;">Select roles to assign to this user:</p>
          
          <div style="max-height: 300px; overflow-y: auto; border: 1px solid #e9ecef; border-radius: 4px; padding: 1rem;">
            <% Cccux::Role.all.each do |role| %>
              <div style="margin-bottom: 1rem; padding: 0.75rem; background-color: <%= @user.roles.include?(role) ? '#e7f3ff' : '#f8f9fa' %>; border-radius: 4px; border: <%= @user.roles.include?(role) ? '2px solid #007bff' : '1px solid #e9ecef' %>;">
                <label style="display: flex; align-items: start; cursor: pointer;">
                  <%= check_box_tag "user[role_ids][]", role.id, @user.roles.include?(role), 
                      style: "margin-right: 0.75rem; margin-top: 0.25rem;" %>
                  <div style="flex: 1;">
                    <strong style="color: #495057; display: block;"><%= role.name %></strong>
                    <% if role.description.present? %>
                      <small style="color: #6c757d; display: block; margin-top: 0.25rem;"><%= role.description %></small>
                    <% end %>
                    <small style="color: #6c757d; display: block; margin-top: 0.25rem;">
                      <%= pluralize(role.ability_permissions.count, 'permission') %>
                    </small>
                    <% if @user.roles.include?(role) %>
                      <small style="color: #007bff; display: block; margin-top: 0.25rem; font-weight: bold;">âœ“ Currently assigned</small>
                    <% end %>
                  </div>
                </label>
              </div>
            <% end %>
          </div>
        </div>
      <% else %>
        <div style="background-color: #fff3cd; color: #856404; border: 1px solid #ffeaa7; border-radius: 4px; padding: 1rem;">
          <strong>No roles available</strong>
          <p style="margin: 0.5rem 0 0 0;">Create some roles first before assigning them to users.</p>
          <%= link_to "Create Role", cccux.new_role_path, 
              style: "background-color: #28a745; color: white; padding: 0.4rem 0.8rem; text-decoration: none; border-radius: 4px; font-size: 0.9rem;" %>
        </div>
      <% end %>

      <% if @user.roles.any? %>
        <div style="background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; border-radius: 4px; padding: 1rem; margin-top: 1rem;">
          <strong>Current Roles:</strong>
          <div style="margin-top: 0.5rem;">
            <% @user.roles.each do |role| %>
              <span style="background-color: #155724; color: white; padding: 0.2rem 0.4rem; border-radius: 3px; font-size: 0.8rem; margin-right: 0.25rem;">
                <%= role.name %>
              </span>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  </div>

  <div style="margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid #e9ecef; text-align: center;">
    <%= form.submit "Update User", 
        style: "background-color: #28a745; color: white; padding: 0.75rem 2rem; border: none; border-radius: 4px; font-size: 1rem; cursor: pointer; margin-right: 1rem;" %>
    <%= link_to "Cancel", cccux.user_path(@user), 
        style: "background-color: #6c757d; color: white; padding: 0.75rem 2rem; text-decoration: none; border-radius: 4px; font-size: 1rem;" %>
  </div>
<% end %> 